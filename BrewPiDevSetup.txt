BrewPi

Built on Ubuntu 16.0.4

Reference guide:
See http://www.jumpnowtek.com/rpi/Raspberry-Pi-Systems-with-Yocto.html




~~~~~~~~~~~~~~~~~~~~ One time setup ~~~~~~~~~~~~~~~~~~~~

Download the following packages: (some aren't neccessary) lol
build-essential
chrpath
diffstat
gawk
git
libncurses5-dev
pkg-config
subversion
texi2html
texinfo
python2.7

# Start work in the following directory
PATH = ~/Projects
MYIP = http://68.190.127.91
mkdir $MYPATH

# Clone my clone of the Yacto poky repository (morty branch):
cd $MYPATH
git clone -b morty $MYIP/Brewcifier/poky-morty

# Clone the following repositories inside the poky repo you just cloned:
cd $MYPATH/poky-morty
git clone -b morty $MYIP/Brewcifier/meta-openembedded
git clone -b morty $MYIP/Brewcifier/meta-qt5
git clone -b morty $MYIP/Brewcifier/meta-brewpi

Create the build directory and link to config files:
mkdir -p $MYPATH/build/conf
ln $MYPATH/poky-morty/meta-brewpi/conf/bblayers.conf $MYPATH/build/conf
ln $MYPATH/poky-morty/meta-brewpi/conf/local.conf $MYPATH/build/conf

# Reference folder structure:
# Projects/
#     poky-morty/
#         meta-openembedded/
#         meta-qt5/
#         meta-brewpi/
#         ...
#     build/
#         conf/

# NOTE: IF YOU HAVE ERRORS ABOUT APACHE LATER ON....
# In $MYPATH/poky-morty/meta-openembedded/meta-webserver/recipes-httpd/apache2
# change the two apache .bb files. The SRC_URI variable needs to use an archived
# version of apache. This is probably done by appending "archive." to the url.
# For example SRC_URI = "http://archive.apache.org/..."


################## Build and Deploy #####################

# Run the build:
cd ~/Projects/
source poky-morty/oe-init-build-env
bitbake brewpi-image


Copy to the SD card:
find the card using lsblk
cd ~/Projects/poky-morty/meta-brewpi/scripts
sudo ./mk2parts.sh mmcblk0
sudo mkdir /media/card
export OETMP=${HOME}/Projects/build/tmp
export MACHINE=raspberrypi
./copy_boot.sh mmcblk0
./copy_rootfs.sh mmcblk0 brewpi




################### Notes and Tools ########################

# The user name of the raspberry pi is root

$ To see list of available packages for adding to image file:
cd $MYPATH
source poky-morty/oe-init-build-env
bitbake -s

$ To clean the image
cd $MYPATH
source poky-morty/oe-init-build-env
bitbake -c clean brewpi-image

# To build for raspberry pi 2 v1.2 model B:
# Change the MACHINE variable in meta-brewpi/conf/local.conf to "raspberrypi"
# When copyping to the SD card, export MACHINE="raspberrypi"

# To build for raspberry pi 3:
# Change the MACHINE variable in meta-brewpi/conf/local.conf to "raspberrypi2"
# When copyping to the SD card, export MACHINE="raspberrypi2"

# Once a bunch of python packages (python-flask, python-werkzeug ...) didn't build
# Error was "ERROR: oe_runmake failed"
# The solution was to run bitbake -c cleanall <python-flask>

# Note: most of the custom recipes exist in the recipes-brewpi but not all...


